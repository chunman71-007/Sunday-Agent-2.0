name: Generate Sunday Sticker

on:
  workflow_dispatch:
    inputs:
      style:
        description: '貼紙樣式 (e.g. birthday, christmas)'
        required: true
        default: 'new_year'
        type: string
      text:
        description: '貼紙文字 (e.g. Happy Purr-thday!)'
        required: false
        default: 'Happy Meow Year'
        type: string

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - name: 拉取最新程式碼
        uses: actions/checkout@v4

      - name: 設定 Python 環境
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 安裝依賴（如果將來有 requirements.txt 就用）
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt || echo "無 requirements.txt，跳過"

      - name: 執行貼紙生成器（安全傳參數 + 詳細 Debug）
        run: |
          echo "=== Debug: 直接從 inputs 上下文獲取的值 ==="
          echo "inputs.style (raw): '${{ inputs.style }}'"
          echo "inputs.text  (raw): '${{ inputs.text }}'"
          echo "fallback style if empty: '${{ inputs.style || 'new_year' }}'"
          echo "fallback text if empty : '${{ inputs.text || 'Happy Meow Year' }}'"
          echo "=== 執行 Python 腳本（使用 fallback 防空值） ==="
          python src/generate_sticker.py \
            "${{ inputs.style || 'new_year' }}" \
            "${{ inputs.text || 'Happy Meow Year' }}"

      - name: Commit and push generated sticker
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git add assets/generated/*
          git commit -m "Auto-generate sticker: ${{ inputs.style || 'new_year' }}_sticker_${{ github.run_id }}" || echo "No changes to commit"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
